<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>üå∑ Malla Curricular Diplom√°tica üå∑</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Nunito', sans-serif;
      background: linear-gradient(to bottom right, #f9f6ff, #fef1ff);
      color: #5a4a7a;
      margin: 0;
      padding: 20px;
      text-align: center;
    }

    h1 {
      font-size: 2em;
      color: #9b71c7;
      margin-bottom: 5px;
    }

    h2 {
      font-weight: normal;
      color: #b68cd2;
      font-size: 1.2em;
      margin-top: 0;
      margin-bottom: 20px;
    }

    #creditos {
      font-weight: bold;
      font-size: 1.2em;
      background-color: #fbe4ff;
      display: inline-block;
      padding: 10px 18px;
      border-radius: 20px;
      color: #7b4992;
      box-shadow: 0 0 6px rgba(157, 102, 173, 0.2);
    }

    #cursos-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px;
    }

    .curso {
      width: 260px;
      margin: 10px;
      padding: 15px;
      background: #fceeff;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 3px 8px rgba(0,0,0,0.08);
      color: #6d4e9d;
      font-weight: 600;
      user-select: none;
    }

    .curso:hover:not(.bloqueado):not(.aprobado) {
      background: #efd6ff;
      transform: translateY(-3px);
    }

    .curso.aprobado {
      background: #d7f5e6;
      color: #3a785f;
      text-decoration: line-through;
      cursor: default;
    }

    .curso.bloqueado {
      background: #f3f0f7;
      color: #b6a7c6;
      cursor: not-allowed;
    }

    #logout-btn {
      margin-top: 30px;
      padding: 12px 30px;
      background: #fbcfe8;
      border: none;
      border-radius: 25px;
      color: #6c4072;
      font-weight: bold;
      font-size: 1.1em;
      cursor: pointer;
      transition: background 0.3s;
    }

    #logout-btn:hover {
      background: #f9a8d4;
    }

    #mensaje-desbloqueo {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #fef3ff;
      color: #7c3aed;
      padding: 12px 24px;
      border-radius: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      font-weight: 600;
      font-size: 1em;
      z-index: 1000;
      transition: opacity 0.3s ease;
      display: none;
    }
  </style>
</head>
<body>

  <h1>üå∏ Malla Curricular de Administraci√≥n P√∫blica üå∏</h1>
  <h2>Modo diplomacia activado ( ÔΩ°‚Ä¢ÃÄ ‚Ä¢ÃÅ)‚úß</h2>
  <div id="creditos">Cr√©ditos Aprobados: 0</div>
  <div id="cursos-container"></div>
  <button id="logout-btn">Cerrar Sesi√≥n üö™</button>
  <div id="mensaje-desbloqueo">&#127881; ¬°Nuevo curso desbloqueado! üìö</div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAxzAJVTV6ioXf0wnyAx2s1-k9-I83xjB0",
      authDomain: "malla-interactiva-ap.firebaseapp.com",
      projectId: "malla-interactiva-ap",
      storageBucket: "malla-interactiva-ap.appspot.com",
      messagingSenderId: "982790383608",
      appId: "1:982790383608:web:0c0100d098ba1713df580d",
      measurementId: "G-D8F2168ZB3"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    const cursos = [
      { nombre: "Matem√°tica para la Gesti√≥n I", prerrequisitos: [], creditos: 8 },
      { nombre: "Introducci√≥n a la Gesti√≥n P√∫blica", prerrequisitos: [], creditos: 8 },
      { nombre: "Historia de las Instituciones Pol√≠ticas", prerrequisitos: [], creditos: 8 },
      { nombre: "Tecnolog√≠as y Sistemas de Informaci√≥n", prerrequisitos: [], creditos: 8 },
      { nombre: "Bases Jur√≠dicas para la Administraci√≥n", prerrequisitos: [], creditos: 8 },
      { nombre: "Ingl√©s I", prerrequisitos: [], creditos: 6 },
      { nombre: "Curso Libre I", prerrequisitos: [], creditos: 8 },
      { nombre: "Matem√°tica para la Gesti√≥n II", prerrequisitos: ["Matem√°tica para la Gesti√≥n I"], creditos: 8 },
      { nombre: "Evoluci√≥n y Complejidad de la Administraci√≥n", prerrequisitos: ["Introducci√≥n a la Gesti√≥n P√∫blica"], creditos: 8 },
      { nombre: "Ideas y Debates Pol√≠ticos Contempor√°neos", prerrequisitos: [], creditos: 8 },
      { nombre: "Epistemolog√≠a de las Ciencias Sociales", prerrequisitos: [], creditos: 8 },
      { nombre: "Marco Normativo I", prerrequisitos: ["Bases Jur√≠dicas para la Administraci√≥n"], creditos: 8 },
      { nombre: "Ingl√©s II", prerrequisitos: ["Ingl√©s I"], creditos: 6 },
      { nombre: "Curso Libre II", prerrequisitos: ["Curso Libre I"], creditos: 8 },
      { nombre: "Estad√≠stica para la Gesti√≥n I", prerrequisitos: ["Matem√°tica para la Gesti√≥n II"], creditos: 8 },
      { nombre: "Comportamiento Humano en la Organizaci√≥n", prerrequisitos: ["Evoluci√≥n y Complejidad de la Administraci√≥n"], creditos: 8 },
      { nombre: "Fen√≥menos Pol√≠ticos", prerrequisitos: ["Ideas y Debates Pol√≠ticos Contempor√°neos"], creditos: 8 },
      { nombre: "Microeconom√≠a para la Gesti√≥n P√∫blica", prerrequisitos: ["Matem√°tica para la Gesti√≥n II"], creditos: 8 },
      { nombre: "Marco Normativo II", prerrequisitos: ["Marco Normativo I"], creditos: 8 },
      { nombre: "M√©todos Cualitativos", prerrequisitos: ["Epistemolog√≠a de las Ciencias Sociales"], creditos: 8 },
      { nombre: "Pol√≠tica Internacional", prerrequisitos: ["Fen√≥menos Pol√≠ticos"], creditos: 8 },
      { nombre: "Dise√±o Organizacional", prerrequisitos: ["Comportamiento Humano en la Organizaci√≥n"], creditos: 8 },
      { nombre: "M√©todos Cuantitativos", prerrequisitos: ["Estad√≠stica para la Gesti√≥n I"], creditos: 8 },
      { nombre: "Planeamiento Estrat√©gico", prerrequisitos: ["Dise√±o Organizacional"], creditos: 8 },
      { nombre: "Gesti√≥n Financiera P√∫blica", prerrequisitos: ["Microeconom√≠a para la Gesti√≥n P√∫blica"], creditos: 8 },
      { nombre: "Negociaci√≥n y Resoluci√≥n de Conflictos", prerrequisitos: ["Comportamiento Humano en la Organizaci√≥n"], creditos: 8 },
      { nombre: "Ciclo y Evaluaci√≥n de Pol√≠ticas P√∫blicas", prerrequisitos: ["Planeamiento Estrat√©gico"], creditos: 8 },
      { nombre: "Contabilidad Gubernamental", prerrequisitos: ["Gesti√≥n Financiera P√∫blica"], creditos: 8 },
      { nombre: "Gesti√≥n de Personas", prerrequisitos: ["Dise√±o Organizacional"], creditos: 8 },
      { nombre: "Gesti√≥n de Proyectos", prerrequisitos: ["Planeamiento Estrat√©gico"], creditos: 8 },
      { nombre: "Electivo I", prerrequisitos: [], creditos: 8 },
      { nombre: "An√°lisis Emp√≠rico de Pol√≠ticas", prerrequisitos: ["M√©todos Cuantitativos", "M√©todos Cualitativos"], creditos: 8 },
      { nombre: "Electivo II", prerrequisitos: ["Electivo I"], creditos: 8 },
      { nombre: "Electivo III", prerrequisitos: ["Electivo II"], creditos: 8 },
      { nombre: "Curso de Formaci√≥n General", prerrequisitos: [], creditos: 8 },
      { nombre: "Simulaci√≥n de Asesor√≠a Pol√≠tica", prerrequisitos: ["Gesti√≥n de Proyectos"], creditos: 8 },
      { nombre: "Pr√°ctica Profesional", prerrequisitos: ["Ciclo y Evaluaci√≥n de Pol√≠ticas P√∫blicas"], creditos: 12 },
      { nombre: "Examen de T√≠tulo", prerrequisitos: ["An√°lisis Emp√≠rico de Pol√≠ticas"], creditos: 12 }
    ];

    let creditos = 0;
    let userEmail = null;

    // Mostrar mensaje de desbloqueo por 2 segundos
    function mostrarMensajeDesbloqueo() {
      const mensaje = document.getElementById("mensaje-desbloqueo");
      mensaje.style.display = "block";
      mensaje.style.opacity = "1";
      setTimeout(() => {
        mensaje.style.opacity = "0";
        setTimeout(() => {
          mensaje.style.display = "none";
        }, 500);
      }, 2000);
    }

    // Guarda progreso en localStorage con key personalizada por usuario
    function guardarProgreso() {
      if (!userEmail) return;
      const key = "malla-" + userEmail.toLowerCase();
      const data = cursos.map(c => ({nombre: c.nombre, aprobado: c.aprobado || false}));
      localStorage.setItem(key, JSON.stringify(data));
      localStorage.setItem(key + "-creditos", creditos);
    }

    // Carga progreso guardado y marca cursos aprobados
    function cargarProgreso() {
      if (!userEmail) return;
      const key = "malla-" + userEmail.toLowerCase();
      const saved = localStorage.getItem(key);
      const savedCreditos = localStorage.getItem(key + "-creditos");
      if (saved) {
        const data = JSON.parse(saved);
        cursos.forEach(curso => {
          const guardado = data.find(d => d.nombre === curso.nombre);
          curso.aprobado = guardado ? guardado.aprobado : false;
        });
      }
      creditos = savedCreditos ? parseInt(savedCreditos) : 0;
      document.getElementById("creditos").textContent = `Cr√©ditos Aprobados: ${creditos}`;
    }

    // Actualiza la vista de cursos y su estado
    function actualizarCursos() {
      const container = document.getElementById("cursos-container");
      container.innerHTML = "";

      cursos.forEach(curso => {
        // Verifica si cumple con todos los prerrequisitos aprobados
        const desbloqueado = curso.prerrequisitos.every(pr =>
          cursos.find(c => c.nombre === pr)?.aprobado
        );

        const estado = curso.aprobado ? "aprobado" : (desbloqueado ? "" : "bloqueado");

        const div = document.createElement("div");
        div.className = "curso " + estado;
        div.textContent = curso.nombre;

        if (estado === "") {
          div.addEventListener("click", () => {
            curso.aprobado = true;
            creditos += curso.creditos;
            document.getElementById("creditos").textContent = `Cr√©ditos Aprobados: ${creditos}`;
            mostrarMensajeDesbloqueo();
            guardarProgreso();
            actualizarCursos();
          });
        }

        container.appendChild(div);
      });
    }

    // Control autenticaci√≥n y carga
    auth.onAuthStateChanged(user => {
      if (!user) {
        // No hay usuario, vuelve a login
        window.location.href = "index.html";
        return;
      }
      userEmail = user.email;
      cargarProgreso();
      actualizarCursos();
    });

    document.getElementById("logout-btn").addEventListener("click", () => {
      auth.signOut().catch(err => alert("Error cerrando sesi√≥n: " + err.message));
    });
  </script>
</body>
</html>
